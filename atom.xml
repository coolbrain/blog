<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ForgeBrain]]></title>
  <link href="http://coolbrain.github.com/atom.xml" rel="self"/>
  <link href="http://coolbrain.github.com/"/>
  <updated>2014-02-23T12:02:45+08:00</updated>
  <id>http://coolbrain.github.com/</id>
  <author>
    <name><![CDATA[ForgeBrain]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[nginx服务器 性能至上]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/nginx-web-server/"/>
    <updated>2014-02-23T11:31:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/nginx-web-server</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iptables 瑞士军刀]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/iptables-firewall/"/>
    <updated>2014-02-23T11:30:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/iptables-firewall</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[初入门规 shell编程]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/shell-programme/"/>
    <updated>2014-02-23T11:29:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/shell-programme</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[龙马精神 马到功成]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/2014-new-year-plan/"/>
    <updated>2014-02-23T11:23:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/2014-new-year-plan</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[长亭外 古道边 芳草碧连天]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/12/end-of-period/"/>
    <updated>2013-12-12T23:33:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/12/end-of-period</id>
    <content type="html"><![CDATA[<blockquote><p><p>离别总是有时让人伤感的，但回来的感觉真好！因为把系统升级到Win8，之前配置写博客和程序也跟着没了。于是前段时间也没有在此写些琐碎的东西，记录生活的点点滴滴。</p>
<!-- more -->
<p>这段时间经历了元旦、春节等传统节日。元旦稍微写了2014年的计划，春节主要是去玩，可惜想找到合适的人一起去玩，是挺不容易的。理想和现实是有差距的，我理想中的玩是即是一种休息娱乐，也是生活中的更高一层的体验。谈谈心，探索啊人生的一些问题，可谓不亦乐乎！没必要把事事看得那么死板、闷气，其实转换个角度，放开心胸，更能够高质量地生活下去。人不可以太纠结于鸡毛蒜皮的事，人可以豁达，正如苏轼所说：“回首向来萧瑟处，也无风雨也无晴。&#8221;</p>
<p>所谓物以类聚，人以群分。和怎样的人相处，就在一定程度上说明你是一个怎样的人，也会是能到达到一个什么程度的人。和有见识有理想有行动的人一起，长智慧；和风趣幽默玩转人生的人一起，长情操。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[修行以行制性 悟道以性施行]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/remote-saver/"/>
    <updated>2013-12-02T21:57:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/remote-saver</id>
    <content type="html"><![CDATA[<p>这个周末，同学分享了《遥远的救世主》，内容不错。对于生活，应该拓宽生活的宽度，多一些内涵与修养，少一些暴躁与戾气。</p>


<p>以下是在谈论中阐述到的语录：</p>


<!-- more -->


<p>1. 所谓真经，就是能够达到寂空涅盘的究竟法门，可悟不可修。修为成佛，在求。悟为明性，在知。修行以行制性，悟道以性施行，觉者由心生律，修者以律制心。不落恶果者有信无证，住因住果、住念住心，如是生灭。不昧因果者无住而住，无欲无不欲，无戒无不戒，如是涅盘。</p>


<p>2.悟道方知天命，修行务取真经， 一生一灭一枯荣，皆有因缘注定。 袈裟原本清净，红尘即是性空， 幽幽古刹千年钟，解了几多痴梦！</p>


<p>3.强势文化就是遵循事物规律的文化，弱势文化就是依赖强者的道德期望破格获取的文化，也是期望救主的文化。强势文化在武学上被称为&#8221;秘笈&#8221;，而弱势文化由于易学、易懂、易用，成了流行品种。</p>


<p>4.天下之道论到极致，百姓的柴米油盐；人生冷暖论到极致，男人和女人的一个情字。</p>


<p>5.更高级的哲人独处着，这并不是因为他想孤独，而是因为在他周围找不到他的同类。</p>


<p>6. 这个年代，执着于出人头地并不难，难的恰恰是不执着于出人头地 ；一颗阴暗的心永远托不起一张灿烂的脸。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[冰雪聪明 超然脱俗]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/the-model-of-huangrong/"/>
    <updated>2013-12-02T21:51:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/the-model-of-huangrong</id>
    <content type="html"><![CDATA[<blockquote><p><p>黄蓉，金庸小说《射雕英雄传》的女主角，刚和郭靖在一起的时候，其敢于面对现实，不受世俗的束缚，不但郭靖的师父就是不同意他们在一起，而且郭靖与华筝有婚姻之约，她也不介意这些，因为在当时她认为两人在一起，只要开心就可以，但其也不是什么事情都不管。她懂得在适当的时候，制造机会让郭靖向洪七公学习武功，并成为其嫡传弟子。因为她也明白，她爹爹是不会喜欢一个文武都不在行的人。</p>
<!-- more -->
<p>在其父亲反对其和傻小子郭靖子在一起，黄蓉一直偏袒着郭靖，直至欧阳锋带着侄儿欧阳克到桃花岛求婚，她爹还有意将其嫁给欧阳克。但黄蓉不屈服于现实，她深知自己力量薄弱，于是千里叫洪七公来挑花岛相助，后来才有欧阳克与郭靖的文武比试。</p>
<p>虽然过了比试，但前路也不平坦。后来两人误会产生，是由于郭靖认定其五个师傅被黄药师所杀。黄蓉在烟雨楼比试时，还感叹好好的幸福就毁于此。她最后简直豁出去了，为了将真相搞明白，和欧阳锋斗智，让真相水落石出。为了让郭靖的大师傅逃出，因为他是整件事情的关键， 她只能落入欧阳锋之手。</p>
<p>两人冰释前嫌，暂时并没有走在一起，黄蓉也没有怪责郭靖误会自己，且暗中帮助其行军打仗，从中出谋划策。郭靖因为发生的种种事情而没有和有婚姻之约的华筝完婚。因为其心里只有一个人，因为两人都懂得为对方付出。在黄蓉被受了铁沙掌的时候，郭靖甘愿为她付出一切。</p>
<p>黄蓉是一个不受所谓的观念，世俗的规则所束缚，同时也是一个敢于追求幸福的人，眼光好，明白郭靖是可造之才和会一心一意对她。这其实在她刚出江湖，办成小乞丐，郭靖却愿意倾其所有让其喝饱吃足，就可知郭靖的人品了。</p>
<p>听闻人生的本质是孤独，寂寞和悲凉，两个孤独的人相处是很容易产生感情。爱情只是让孤独的人类能够活下来。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[管中窥豹 盲人摸象]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/newbie-of-java/"/>
    <updated>2013-12-02T20:05:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/newbie-of-java</id>
    <content type="html"><![CDATA[<p>实习期间，课题是openacs的继续开发，由于openacs是Java开发，因此做了两个月的Java开发，稍微总结一下：</p>


<p>Java的容器Collection类库，String、Array，list，map等，特别是与数据库操作结合在一起的时候，但性能比起直接使用SQL会略差些。但Java的接口如Comparable，serialize等，实现对象的排序和序列化。并且懂得如何将对象序列化保存到数据库，然后再从数据库中读出，也同时使用blob字段保存大容量的数据字段。</p>


<blockquote><p><!-- more --></p></blockquote>

<p>Java的servlet技术，request，response，session，cookie等，这些封装了http的对象，不过session是使http具有会话性的，而cookie主要是保存用户的信息。</p>


<p>Java的正则表达式的易用性,在当时的项目里，使用正则表达式处理字符串相当好，一下子就把问题解决了</p>


<p>Java的JSF使用，不过我比较讨厌控件的使用。因为我不愿意学这些东西。这只是我的借口，这些东西的设计都是比较类似的，学会一个，基本上就会使用其它的一些控件。</p>


<p>Java的EJB企业服务Bean，Java的soap类库，Java的JMS通信，这些在实现一些业务逻辑的时候会比较方便。并且终于感受到了Java抽象类，继承的优势所在，动态绑定对象，用instanceof来检测对象的类型，从而触发相应的逻辑。</p>


<p>过去的时光对于我来说，虽然是一个不好的经历。只可惜，以前自己没有体会到这些，不然就不会落得如此田地！浪子回头金不换。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[你知道了你 你就不是你]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/01/intern-summary/"/>
    <updated>2013-12-01T22:58:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/01/intern-summary</id>
    <content type="html"><![CDATA[<p>实习期间我被分配完成的项目是openACS开发，可是openACS是Java开发，且是J2EE的范畴。我之前以为自己来这个公司是做C语言，网络方面的开发的，但却分配到做Java的，当时就不想在上面花时间，因此开始做的两个星期都是敷衍了事，再继续了两个星期，却发现Java易用，有丰富的类库API，J2EE框架清晰。与之前对Java的印象截然不同，于是才开始不断学习Java，继续openACS的开发。显然，在刚开始之前，我没有转变自己的观念，其实编程，在于的不是使用哪一种语言，而是在于从整体上把握编程思想。不论对于何种语言，都适用。在时间安排上，只要及早地改变心态，可以提前地完成任务，做更多的工作。</p>


<blockquote><p><!-- more --></p></blockquote>

<p>对于答辩，有几点需要改进：</p>


<p>1.对某些概念理解不清，画图不够严谨，没有好好总结之前所学的内容和检查PPT的细节问题。</p>


<p>2.答辩时，态度不够严肃，语速慢。之前没有进行实战演练，观察有什么问题。</p>


<p>3.回答问题时，没有明白对方问题的用意而急于回答。学会倾听，把握好问题，才进行相应的回答。</p>


<p>对于工作，有几点需要改进：</p>


<p>1.对于每天的工作，有一定的安排和目标性，在每天结束后，稍微总结下今天所做的工作。</p>


<p>2.平时休息要好，不能熬夜，影响到正常工作的效率和质量。</p>


<p>3.多点和导师和其它同事交流，从而用更好地方式解决问题。</p>


<p>对于现在openACS开发的情况，基本上继续完成接下来的一些需求的开发，整理好文档和进行相关的测试。</p>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[承上启下 向下兼容]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/16/follow-version/"/>
    <updated>2013-10-16T23:10:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/16/follow-version</id>
    <content type="html"><![CDATA[<blockquote><p><p>window XP默认安装的.NET的2.0版本，window 7默认安装的是.NET4.0版本，而更新的系统就可能安装更新的.NET版本。但好不幸，假如你还在使用XP系统的话，但又想使用最新开发的程序，那么你就安装.NET的比较新的版本了，因为XP .NET2.0版本已经不能支持这些最新开发的程序。但在较新的系统跑较旧的程序，可能就会有些问题，因为有些API会被抛弃。</p>
<!-- more -->
<p>上面是对于在window的.NET平台上开发的程序来说。而在Java平台开发的，比较新的程序要需要运行在较新的JDK上，如JDK 7；较旧的程序也要求运行在较旧的JDK上，如JDK 5；用JDK 5开发的程序未必在JDK 7平台是那个跑，如上面提到的有些API已经被抛弃，可能还需要安装插件。因此下载程序的时候，看清楚所运行的环境，避免不必要的麻烦。</p>
<p>而对于python这样的脚本语言，道理依然是一样，之前写出来的版本只对python2.7有效，对于python3.2就可能无效，除非进行接口的移植和升级。现在的web开发是考虑兼容性最多的，不同的浏览器有不同的实现和不同标准，程序员需要针对每个浏览器写出不同支持性的代码。人人都希望一份通用的代码就能到处跑。另一个方面是通信领域，同样的通信协议，不同的厂商对协议的理解和实现都不一样，导致不同厂商生产的设备直接的通信出现问题。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[依山伴水 绿水长流]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/16/view-of-shenzhen/"/>
    <updated>2013-10-16T00:06:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/16/view-of-shenzhen</id>
    <content type="html"><![CDATA[<blockquote><p><p>外人眼中的深圳是一夜之间崛起的城市。那已经是History了，我想说的Now。生活在深圳，究竟会是怎样？</p>
<!-- more -->
<p><strong>公共设施</strong></p>
<p>按照广州生活的经验来说，广州没什么是触动心灵的，但也不是一无所长，广州在地铁指引方面比深圳做得好，但广州地铁比深圳拥挤。深圳是被称为“图书馆之城”，每个区都有几个图书馆，且有些图书馆设备、环境都是一流，只要有身份证，无论什么人，都可以办理借书证，且全城图书通借通还。深圳的公园搞得特别不错，周六日深圳人都会一家大小到公园玩，整个环境特别和谐。同样深圳的医疗也是相当不错，服务质量和服务态度比广州更上一层楼。</p>
<p><strong>旅游景点</strong></p>
<p>世界之窗（window of world)和锦绣中华(splendid of China)是深圳两大特色景点。</p>
<p><strong>人的素质</strong></p>
<p>深圳的人比较友好，讲文明，基本上的人都是从外面来的，而之后成为深圳人。杂居文化。</p>
<p><strong>发展机会</strong></p>
<p>政策相对好，改革开放的前沿阵地。名企云集之地。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[除了我的无知，我什么都不知道]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/15/live-by-yourself/"/>
    <updated>2013-10-15T22:22:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/15/live-by-yourself</id>
    <content type="html"><![CDATA[<blockquote><p><p>所谓活在这个世界上，许多的烦恼，快乐，平静，温馨，幸福都是由自己的看法所决定的，影响自己不是事情的本事，而是看待事情的方式。有许多次的时候都是“当局者迷旁观者清”的情况，为了避免被一些琐事所困，列出一些常见问题的处理：</p>
<!-- more -->
<p>1.如何做到学有所获？不是糊里糊涂,没有得过且过的感觉？</p>
<p><strong>使用思维导图，层次级描述</strong></p>
<p>2.如何做到自我管理、自我满足？</p>
<p><strong>不蹉跎岁月，把握每分每秒，做一些有意义的事情</strong></p>
<p>3.如何犯了错误时，如何做到不慌慌张张、自怨自艾，反而是淡淡定定地解决问题？</p>
<p><strong>对事情的发生深入分析，做到心中有数</strong></p>
<p>4.如何保证自己的身体健康?</p>
<p><strong>关键是合理的饮食，次之是适当的放松（旅游、打球、看书），但强烈不建议听歌、看电影、看电视剧</strong></p>
<p>5.如何丢弃心理压力的包袱？</p>
<p><strong>看事情不能只从一个角度去看，要多角度分析。不然在一方面吃亏，就焦虑至死</strong></p>
<p>6.平时做人的原则是什么?</p>
<P><strong>论语十则中的：“与朋友交而不信乎？” “己所不欲勿施于人”</strong></p>
<p>7.平时学习的原则是什么？</p>
<p><strong>”温故而知新“；“学而不思则罔思而不学则殆”</strong></p>
<p>8.平时如何去做人？</p>
<p><strong>合理表达请求；婉转表达不满或拒绝；换位思考；三思而后讲</strong></p>
<p>9.人存在的基础是什么？</p>
<p><strong>身体;思想;价值观;世界观</strong></p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[青衫磊落险峰行 玉璧月华明]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/14/fairy-story/"/>
    <updated>2013-10-14T23:10:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/14/fairy-story</id>
    <content type="html"><![CDATA[<blockquote><p><p>之前两日去图书馆准备充电，恰好桌面有一本《天龙八部》，于是随便翻翻，手不释卷就到图书馆关门了。自己背包里的书深藏不露，可惜没有见到天日,还没有大展拳脚，就已经夭折了。</p>
<!-- more -->
<p>既然看了，那就写写关于《天龙八部》的故事吧。</p>
<p>乔峰是个盖世英雄，只可惜被揭为契丹人，两国水火不容，群雄聚而攻之。种种的误解产生都由其父处处布局，让乔峰如老鼠过街人人喊打，考验其绝处逢生的能力。乔峰与阿朱&#8211;这个小丫头互生情愫，阿朱对乔峰的为人和英雄气概极为倾慕；而为身世所困，百思不得其解的乔峰，人人得而诛之的乔峰，心灵无尽空虚的乔峰，在这时，得到阿朱死心塌地的关心和约其到漠北放羊，长相厮守，远离中原的纷争和骚扰。</p>
<p>段誉，人人都说其是书呆子，一心一意地钻研佛学，有普渡众生的理想。机缘巧合，与神仙姐姐塑像偶遇，对其简直是痴迷，向其叩了一千个响头。在曼陀山庄，见到现实之中的神仙&#8211;美丽与智慧的化身&#8211;王语嫣，所谓“窈窕淑女君子好逑”，可惜她心有所属，但对于段誉来说，虽然常被人说：“癞蛤蟆想吃天鹅肉”，但其很珍惜眼前与王语嫣相处的时间，常常寻找机会跟随左右。不是为了博取红颜一笑，而总是舍身相救。</p>
<p>虚竹，一心向佛，心地善良，似笨头笨脑，也似大智若愚，也如郑板桥所说的难得糊涂，无人能解的棋局，其误打误撞创出一片天地，扭转乾坤。小事情糊涂，大事情明白。</p>
<p>木婉清，一个从没见过世面的姑娘，认为吃人肉也是理所当然的，无任何伦理，道德的观念。不过，段誉却能对这个姑娘尊重有加。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[鞭辟入里 明辨事理]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/10/fact-opinion/"/>
    <updated>2013-10-10T22:36:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/10/fact-opinion</id>
    <content type="html"><![CDATA[<blockquote><p><p>when I read the passage, I always can&#8217;t consciously distinguish the fact and opinion. Sometimes I think the author&#8217;s personal opinion as the fact.if having chance to talk with other&#8217;s, I boast about their opionion though I don&#8217;t know which is original, objective or personal view.The most fearest thing is that I put them into practice and consequently find that they are wrong and liable and I have already wasted a lot of time and done harm to myself.</p>
<!-- more -->
<p>For example,&#8221;no man ever look at the world with pristine eyes. He sees it edited by a definite set of customs and institutions and ways of thinking.&#8221; It sounds reasonable, and may be objective.To persuade reader, the author consequently list fact and eminent man&#8217;s word to support his opinion. Our teacher taught us in junior school.</p>
<p>&#8220;Boardly speaking, human being may be divided into three classes:those who are toiled to death, those who are worried to death, and those who are bored to death.&#8221;The author acquires this opinion according to his observation and reflection. Whatever, he spares no effort to supporting and describing his opinion.&#8221;The seeds must be carefully chosen; they must fall on good ground;they must be sedulouly tended, if the vivifying fruits are to be at hand when needed.&#8221; he uses metaphor describing the process of cultivating hobbies to make reader be aware of the importance of it.</p>
<p>&#8220;The undulating waves of the open sea are generated by three natural causes:wind, earth movements or tremors, and the gravitational pull of the moon and the sun.&#8221;This is fact based on the result of current research which may be overthrowed in the future.It&#8217;s natural phenomenon. &#8220;Appreciaton of sculpture depends upon the ability to respond to form in three dimensions.&#8221; It seems opinion but it&#8217;s fact.</p>
<p>&#8220;This is a sceptical age, but although our faith in many of the things in which our forefathers fervently believed has weakened, our confidence in the curative properties of the bootle of medicine remains the same as theirs&#8221;.Why does the author have this opinion? &#8220;This modern faith in medicines is proved by the fact that the annual drug bill of the Health Services is mounting to astronomical figures and shows no signs at present of ceasing to rise.&#8221; he gets it based on data which we can check on the internet. If the author want to cheat, he may forge some data or fact to support his opinion. Maybe we carelessly trust and suffer a lot.</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[穿梭于都市 游走于海滨 休憩于公园]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/05/swim-park-drink/"/>
    <updated>2013-10-05T21:26:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/05/swim-park-drink</id>
    <content type="html"><![CDATA[<blockquote><p><p>国庆第二天目标地点是深圳大梅沙海滨公园，想不到这个海滨公园吸引了五万的游客，在高速公路塞车了两个小时，可把我憋腻了。幸亏我在车上找到另外一种方式来消遣——背单词，兴致盎然，让自己醉于自己的世界，完全感觉不到自己在拥挤不堪的公共汽车上。这种方式打发这样的时光还是非常有效，所以说，影响自己不是事情本身，而是看待事情的方式。</p>
<!-- more -->
<p>经过两个小时，终于到达了目的地——大梅沙，两面环山，前面是海，看到浪一浪接一浪，大家在海水里玩得很开心。忍不住换上泳裤，冲入水里，当海水碰到嘴唇里，才发现海水挺咸的，不像以前在河里玩水，应该有个救生圈，躺在上面，任意其飘荡，享受阳光沐浴。总体来说，感觉还可以，但感觉地方有点不太干净，可能由于是免费的原因，下次再次来海滨玩的话，应该去小梅沙。晚上回来再在租屋的地方K歌，三个男人一台戏。</p>
<p>国庆第三天是深圳的红树林，闻说里面可以看到比较多的鸟，可谓百鸟争鸣。当我们去到的时候，感觉没什么特别，就是带有海湾的公园。不过，在走之前，买了一个椰子，第一次享受喝椰子汁的快感。接着去了市区的莲花山，从莲花山上鸟瞰深圳的中心，高楼林立，器宇轩昂。之后就在市区中心徘徊，市民中心，深圳书城，少年宫&#8230;</p>
<p>国庆的第四天送别了故人，就把精力集中于解决自身的问题，首当其冲的就是耳鸣。我说多少个叫自己重视这些问题也无济于事，最紧要自己心理明白，这问题不能忽视，要用心地呵护。发现在医院看书的效果挺好，在这里才会真正感受病是如此地真实，假如再不珍惜，再继续这样下去，只会抱恨终生。所以当自己不想看书的时候，可以到医院去看，相信是一个不错的选择，:)</p>
<p>晚上又和宿友讨论了下现实和理想之间的差距。主要的观点是：”电影，电视剧，歌曲，只是用来陶冶情操的，而不是用来实现理想的“，因为好多些时候这些都是理想状态，在现实可能到处碰壁，事与愿违。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[锦绣中华 民族风情]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/02/splendid-china/"/>
    <updated>2013-10-02T00:15:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/02/splendid-china</id>
    <content type="html"><![CDATA[<blockquote><p><p>来深圳一段时间，之前去过世界之窗，是各大世界名胜古迹的赝品，觉得还挺好看的。于是决定继续游览深圳，国庆的第一个目标地点就是锦绣中华文化村，其实是分为锦绣中华（中国各个地方的名胜古迹的赝品）和中国民俗文化村，今日的游览路线冥冥之中注定是正确的。向右走，去中国民俗文化村。</p>
<!-- more -->
由于无带相机，只能用手机将就，在中国民俗文化村的我。
<img src="http://coolbrain.github.com/assets/images/splendChina/me.jpg" alt="&quot;me&quot;" />
<p>去中国民俗文化村的正确所在是能看到各色各样的表演，即各个少数民族的特色的表演。苗族的表演：芦笙场恋歌，讲解了作为苗家准新郎的标准，分别为能喝（酒），多才多艺，能干（挑一百二十斤的担子）；
附苗家女子的表演：
<img src="http://coolbrain.github.com/assets/images/splendChina/miao_national.jpg" alt="&quot;miao_national&quot;" />
<p>摩梭族的表演：独特的母系社会风情，并讲解了走婚；黎族的陀螺表演；看了龙腾天下和走进亚洲之心影片。并看了三场大型的表演，一就是汇聚五十六个民族，展现各个民族风情的大表演；二就是金戈王朝，展现的是真实的历史战争场面，各种马技的表演；
<img src="http://coolbrain.github.com/assets/images/splendChina/warfield.jpg" alt="&quot;warfield&quot;" />
<p>三就是龙凤舞中华，大型特效，展现中华的民俗风情。十一去这地方，虽然比较多人，但同时看表演的机会也大大增加，觉得物有所值。</p>
<p>而另外一个锦绣中华，就觉得有些闷了。从布达拉宫，嘉峪关，莫高窟，黄果树瀑布，秦兵马俑，故宫，中山陵，颐和园，圆明园，西湖，黄鹤楼，云南大理三塔，桂林山水等走出来，觉得之前活生生的表演比这些东西好看多了，因为这些都是赝品，没有宏伟壮观，没有真实的感觉，和在电脑上看照片的效果一样，那就失去了其意义。</p>
<p>综合来说，这个十一的第一日过得还是相当不错的。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[周星驰不只是一个噱头]]></title>
    <link href="http://coolbrain.github.com/blog/2013/09/29/funny-hero/"/>
    <updated>2013-09-29T23:33:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/09/29/funny-hero</id>
    <content type="html"><![CDATA[<blockquote><p><p>近期这个月都在看周星驰的电影，无厘头的对白有时候令人捧腹大笑；但有时细细体味，有时候又挺沉重。电影“大话西游”之《月光宝盒》和《仙履奇缘》绝对是经典中的经典，上品中的上品。当紫霞仙子临走说：“我的意中人是个盖世英雄，有一天他会踩着七色的云彩来娶我。我猜中了前头，可是我猜不着这结局……“，这怎么不令人心酸呢？女子心中对她的另一半都会充满期待，是一个如唐伯虎的江南才子，玉树临风；或者是会十八般武艺，多才多艺的孙悟空。</p>
<!-- more -->
<p>而至尊宝用来骗紫霞仙子的广为流传的一段话：“曾经有一份真挚的感情摆在我的面前，我没有珍惜，等我失去的时候才追悔莫及，人世间最痛苦的事莫过于此。如果上天能给我一次再来一次的机会，我会对那个女孩说三个字：我爱你。如果非要在这份爱上加一个期限，我希望是一万年”，这是海誓山盟，还是骗人伎俩？其实这是无厘头，真挚的感情，当时星仔不屑一顾，而现在又说成追悔莫及，并且最后又夸张到爱你一万年，哈哈哈&#8230;</p>
<p>白晶晶：省省吧你！改变什么形象，好好地做你山贼这份很有前途的职业去吧！这又是无厘头了，山贼本来是不正当的职业，还加上前途二字，令人哭笑不得。</p>
<p>从小到大，梁朝伟和周星驰是对好朋友，有一次星仔叫上梁朝伟一起去参加无线演员培训面试，哪知道满腔热血的周星驰落选了，而陪伴的梁朝伟却被选中了。周星驰出来的混的时也只是跑龙套而已。但他能够坚持到最后，最关键的是他能创造出自己无厘头的风格。成龙虽然是武打巨星，拍电影的时候也会经常受伤，但星爷就凭着富有表情的脸和无厘头的笑话，就与成龙齐名了，这就是一个与众不同，力求创新的人的特色。成龙可以说李小龙的延续，因为李小龙开创了在电影中引入武打、功夫等元素，且具有极大的娱乐趣味和观赏性，且凭借这一部《龙争虎斗》就打入了国际舞台，改变了中国人在世界的形象。这些人都是香港人，即是中国人，香港这个弹丸之地，出现这么多优秀的因素有其历史的原因，日本侵华时期，大量华人逃到香港，文化大革命时期，同样许多人潜渡到香港。假如佛山的叶问不是为了逃避日本人，那么李小龙也就学不到真正上乘的功夫，那么根本就不存在李小龙。</p>
<p>星爷的电影还是比较有特色的：《唐伯虎点秋香》、《喜剧之王》、《功夫》、《赌神》、《赌侠》、《少林足球》等，特别是《喜剧之王》以自己的经历拍成一部无厘头的电影，阐述一路走来的心酸和历程。当时有个镜头是星仔对成龙大哥说的一段话：&#8221;大哥，你从哪学拍戏的啊！怎么学得这么好啊！可不可以教教我啊？“星仔是中国版的史泰龙，史泰龙曾经拿着自编自导的《洛奇》拜访各大好莱坞的电影公司，希望能获得投资，最后功夫不负有心人。星爷从一名演员，逐渐到现在是比高集团的董事长了，并且还自编自导了《西游降魔记》，从而看得出星爷多用心经营自己。香港还有一个演员叫周润发，这个是唯一一个写入教科书的演员，因为其经历从小贫苦，且一路坚持，孝顺父母。香港的票房保证是“双周一龙”，周星驰，周润发，成龙已经是成为香港的招牌。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[接近尾声 两手空空]]></title>
    <link href="http://coolbrain.github.com/blog/2013/09/29/train-summary/"/>
    <updated>2013-09-29T22:57:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/09/29/train-summary</id>
    <content type="html"><![CDATA[<blockquote><p><p>在TP-Link基础的培训基本结束了，培训的内容都浮于表面，要在工作时候才能真正地深入了解和掌握。在培训期间因为一些简单的问题而浪费时间的操作，在此记录，以此为戒。</p>
<!-- more -->
<p>window netsh是一个强大的网络配置工具，如配置IPv4的网络地址，掩码，网关：netsh interface IP addr address &#8220;本地连接“ 192.168.1.2 255.255.255.0 192.168.1.1.配置IPv6同样道理，还可以显示丰富的网络信息，如WLAN，LAN等，显示路由信息router print。相对于linux netstat工具，netsh interface IP show tcpconn 显示了tcp，udp的连接数目和所处的状态。</p>
<p>linux下配置IP地址，ip addr add 803c::abcd:bcde:efce:1235 dev eth0(网络接口），添加路由表项：ip route add 192.168.1.1 dev eth0, 添加 ipv6的路由表项：route -A inet6 add  &#8230; , 要学会man，且看得懂其命令的解释，了解iptables，iP6tables等。</p>
<p>虚拟机网络适配器的理解：最简单的是桥接（bridge），与主机同一个网段，使用VMnet0虚拟网卡，相当于虚拟交换机。NAT,与主机共享网络，使用VMnet8虚拟网卡，相当于平时路由器的NAT功能；Host only，与主机同一个网络，但不具备NAT功能，所以不能与主机共享上网，使用的VMnet1，内部可自动分配IP地址，说明虚拟机具有DHCP服务器。</p>
<p>IPv6的ping:ping -6 fe80::abcd:befe:dc12:3458%5, %后面指的是从计算机哪个网口出去，如果不再同一个网络，就会ping不通。<p>
<p>无线中应该了解802.11b,g,n的区别；在DSL中了解到pppoe，pppoa，ipoa，static ip，dynamic ip的区别；在ipv6中了解到ipv6的地址的使用范围；在简单的局域网中了解arp的欺骗，arp协议中在以太网中的作用；学习了PPP协议，DHCP协议等协议；学习了NAT的几种类型，及其NAT的穿透；学习了转发规则：DMZ，virtual server, upnp, port trigger的区别。</p>
<p>编程中学习到动态链接库的操作，共享内存的操作，网络帧的解析（注意网络字节序），函数分工，字节位操作（特别是乘法和除法），switch和if_else的区别，栈溢出的注意，按目录编译Makefile文件。</p></p>

<p><p>这个星期前三天主要是依据TR069的英文文档写中文文档，主要还是翻译，以加强对协议的理解。同时也对TD-8968的对TR069的测试，以进一步了解TD-8968对协议的支持情况，主要是了解其支持的TR098数据模型。</p>
<p>之后也就是OpenACS，了解了基本操作，同时也有一些问题存在。也看了openACS的代码，</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pjsip状态机]]></title>
    <link href="http://coolbrain.github.com/blog/2013/09/26/pjsip-state-machine/"/>
    <updated>2013-09-26T23:38:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/09/26/pjsip-state-machine</id>
    <content type="html"><![CDATA[<blockquote><p><p>近期在voip skeleton上增加了一个简单的状态机，分别是当前的状态（current state），事件（event），新的状态（new state），操作（action），使用的是list链表的方式管理，实现动态注册状态的处理。在pjsip 事务（transation state machine）状态机使用的是用数组的方式来实现，数组的下标为状态，内容为操作handle。</p>
<!-- more -->
<p>pjsip的事务状态用枚举定义：</p></p></blockquote>

<figure class='code'><figcaption><span>transation状态声明  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * This enumeration represents transaction state.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">pjsip_tsx_state_e</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_NULL</span><span class="p">,</span>   <span class="cm">/**&lt; For UAC, before any message is sent.   */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_CALLING</span><span class="p">,</span>    <span class="cm">/**&lt; For UAC, just after request is sent.   */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_TRYING</span><span class="p">,</span> <span class="cm">/**&lt; For UAS, just after request is received.*/</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_PROCEEDING</span><span class="p">,</span> <span class="cm">/**&lt; For UAS/UAC, after provisional response.*/</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_COMPLETED</span><span class="p">,</span>  <span class="cm">/**&lt; For UAS/UAC, after final response.     */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_CONFIRMED</span><span class="p">,</span>  <span class="cm">/**&lt; For UAS, after ACK is received.        */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_TERMINATED</span><span class="p">,</span> <span class="cm">/**&lt; For UAS/UAC, before it&#39;s destroyed.    */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_DESTROYED</span><span class="p">,</span>  <span class="cm">/**&lt; For UAS/UAC, will be destroyed now.    */</span>
</span><span class='line'>    <span class="n">PJSIP_TSX_STATE_MAX</span>        <span class="cm">/**&lt; Number of states.              */</span>
</span><span class='line'><span class="p">}</span> <span class="n">pjsip_tsx_state_e</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><p>pjsip状态处理函数的定义：</p></p></blockquote>

<figure class='code'><figcaption><span>transation状态处理函数声明  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_null</span><span class="p">(</span>      <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                              <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_calling</span><span class="p">(</span> <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                              <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_trying</span><span class="p">(</span>      <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                              <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_proceeding_uas</span><span class="p">(</span> <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_proceeding_uac</span><span class="p">(</span> <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_completed_uas</span><span class="p">(</span>   <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_completed_uac</span><span class="p">(</span>   <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_confirmed</span><span class="p">(</span>   <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_terminated</span><span class="p">(</span>  <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_destroyed</span><span class="p">(</span>   <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><p>pjsip状态机的注册：</p></p></blockquote>

<figure class='code'><figcaption><span>transation 状态注册  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* State handlers for UAC, indexed by state */</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">tsx_state_handler_uac</span><span class="p">[</span><span class="n">PJSIP_TSX_STATE_MAX</span><span class="p">])(</span><span class="n">pjsip_transaction</span> <span class="o">*</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">pjsip_event</span> <span class="o">*</span><span class="p">)</span> <span class="o">=</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_null</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_calling</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_proceeding_uac</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_completed_uac</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_confirmed</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_terminated</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_destroyed</span><span class="p">,</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* State handlers for UAS */</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">tsx_state_handler_uas</span><span class="p">[</span><span class="n">PJSIP_TSX_STATE_MAX</span><span class="p">])(</span><span class="n">pjsip_transaction</span> <span class="o">*</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">pjsip_event</span> <span class="o">*</span><span class="p">)</span> <span class="o">=</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_null</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_trying</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_proceeding_uas</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_completed_uas</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_confirmed</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_terminated</span><span class="p">,</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">tsx_on_state_destroyed</span><span class="p">,</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><p>当相应的事件来临时，就调用相应的处理函数handle和改变自身的状态，如ack来临，或者超时重传：</p></p></blockquote>

<figure class='code'><figcaption><span>transation调用相应的处理函数  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * State Calling is for UAC after it sends request but before any responses</span>
</span><span class='line'><span class="cm"> * is received.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">static</span> <span class="n">pj_status_t</span> <span class="nf">tsx_on_state_calling</span><span class="p">(</span> <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>                       <span class="n">pjsip_event</span> <span class="o">*</span><span class="n">event</span> <span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">pj_assert</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">PJSIP_TSX_STATE_CALLING</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pj_assert</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">role</span> <span class="o">==</span> <span class="n">PJSIP_ROLE_UAC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">PJSIP_EVENT_TIMER</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>  <span class="n">event</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">.</span><span class="n">timer</span><span class="p">.</span><span class="n">entry</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">pj_status_t</span> <span class="n">status</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Retransmit the request. */</span>
</span><span class='line'>        <span class="n">status</span> <span class="o">=</span> <span class="n">tsx_retransmit</span><span class="p">(</span> <span class="n">tsx</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">PJ_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">PJSIP_EVENT_TIMER</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>         <span class="n">event</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">.</span><span class="n">timer</span><span class="p">.</span><span class="n">entry</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Cancel retransmission timer. */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">transport_flag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">TSX_HAS_PENDING_RESCHED</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Set status code */</span>
</span><span class='line'>  <span class="n">tsx_set_status_code</span><span class="p">(</span><span class="n">tsx</span><span class="p">,</span> <span class="n">PJSIP_SC_TSX_TIMEOUT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Inform TU. */</span>
</span><span class='line'>  <span class="n">tsx_set_state</span><span class="p">(</span> <span class="n">tsx</span><span class="p">,</span> <span class="n">PJSIP_TSX_STATE_TERMINATED</span><span class="p">,</span>
</span><span class='line'>                       <span class="n">PJSIP_EVENT_TIMER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Transaction is destroyed */</span>
</span><span class='line'>  <span class="c1">//return PJSIP_ETSXDESTROYED;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">PJSIP_EVENT_RX_MSG</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pjsip_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">code</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Get message instance */</span>
</span><span class='line'>  <span class="n">msg</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">.</span><span class="n">rx_msg</span><span class="p">.</span><span class="n">rdata</span><span class="o">-&gt;</span><span class="n">msg_info</span><span class="p">.</span><span class="n">msg</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Better be a response message. */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">PJSIP_RESPONSE_MSG</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">PJSIP_ENOTRESPONSEMSG</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">code</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">.</span><span class="n">status</span><span class="p">.</span><span class="n">code</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* If the response is final, cancel both retransmission and timeout</span>
</span><span class='line'><span class="cm">  * timer.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">lock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="n">unlock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="cm">/* Cancel retransmit timer (for non-INVITE transaction, the</span>
</span><span class='line'><span class="cm">      * retransmit timer will be rescheduled at T2.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/* For provisional response, only cancel retransmit when this</span>
</span><span class='line'><span class="cm">      * is an INVITE transaction. For non-INVITE, section 17.1.2.1</span>
</span><span class='line'><span class="cm">      * of RFC 3261 says that:</span>
</span><span class='line'><span class="cm">      *  - retransmit timer is set to T2</span>
</span><span class='line'><span class="cm">      *  - timeout timer F is not deleted.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">PJSIP_INVITE_METHOD</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/* Cancel timeout timer */</span>
</span><span class='line'>      <span class="n">lock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">unlock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">is_reliable</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">TIMER_ACTIVE</span><span class="p">;</span>
</span><span class='line'>          <span class="n">pjsip_endpt_schedule_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span>
</span><span class='line'>                         <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">retransmit_timer</span><span class="p">,</span>
</span><span class='line'>                         <span class="o">&amp;</span><span class="n">t2_timer_val</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">transport_flag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">TSX_HAS_PENDING_RESCHED</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Discard retransmission message if it is not INVITE.</span>
</span><span class='line'><span class="cm">  * The INVITE tdata is needed in case we have to generate ACK for</span>
</span><span class='line'><span class="cm">  * the final response.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>  <span class="cm">/* Keep last_tx for authorization. */</span>
</span><span class='line'>  <span class="c1">//blp: always keep last_tx until transaction is destroyed</span>
</span><span class='line'>  <span class="c1">//code = msg-&gt;line.status.code;</span>
</span><span class='line'>  <span class="c1">//if (tsx-&gt;method.id != PJSIP_INVITE_METHOD &amp;&amp; code!=401 &amp;&amp; code!=407) {</span>
</span><span class='line'>  <span class="c1">//    pjsip_tx_data_dec_ref(tsx-&gt;last_tx);</span>
</span><span class='line'>  <span class="c1">//    tsx-&gt;last_tx = NULL;</span>
</span><span class='line'>  <span class="c1">//}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Processing is similar to state Proceeding. */</span>
</span><span class='line'>  <span class="n">tsx_on_state_proceeding_uac</span><span class="p">(</span> <span class="n">tsx</span><span class="p">,</span> <span class="n">event</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pj_assert</span><span class="p">(</span><span class="o">!</span><span class="s">&quot;Unexpected event&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">PJ_EBUG</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">PJ_SUCCESS</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><p>pjsip 事务相应状态改变函数：</p></p></blockquote>

<figure class='code'><figcaption><span>transation状态改变和改变相应处理函数  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Set transaction state, and inform TU about the transaction state change.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">tsx_set_state</span><span class="p">(</span> <span class="n">pjsip_transaction</span> <span class="o">*</span><span class="n">tsx</span><span class="p">,</span>
</span><span class='line'>             <span class="n">pjsip_tsx_state_e</span> <span class="n">state</span><span class="p">,</span>
</span><span class='line'>             <span class="n">pjsip_event_id_e</span> <span class="n">event_src_type</span><span class="p">,</span>
</span><span class='line'>                           <span class="kt">void</span> <span class="o">*</span><span class="n">event_src</span> <span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">pjsip_tsx_state_e</span> <span class="n">prev_state</span> <span class="o">=</span> <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* New state must be greater than previous state */</span>
</span><span class='line'>    <span class="n">pj_assert</span><span class="p">(</span><span class="n">state</span> <span class="o">&gt;=</span> <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">PJ_LOG</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">obj_name</span><span class="p">,</span> <span class="s">&quot;State changed from %s to %s, event=%s&quot;</span><span class="p">,</span>
</span><span class='line'>         <span class="n">state_str</span><span class="p">[</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">],</span> <span class="n">state_str</span><span class="p">[</span><span class="n">state</span><span class="p">],</span>
</span><span class='line'>               <span class="n">pjsip_event_str</span><span class="p">(</span><span class="n">event_src_type</span><span class="p">)));</span>
</span><span class='line'>    <span class="n">pj_log_push_indent</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Change state. */</span>
</span><span class='line'>    <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Update the state handlers. */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">role</span> <span class="o">==</span> <span class="n">PJSIP_ROLE_UAC</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state_handler</span> <span class="o">=</span> <span class="n">tsx_state_handler_uac</span><span class="p">[</span><span class="n">state</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">state_handler</span> <span class="o">=</span> <span class="n">tsx_state_handler_uas</span><span class="p">[</span><span class="n">state</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Before informing TU about state changed, inform TU about</span>
</span><span class='line'><span class="cm">     * rx event.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">event_src_type</span><span class="o">==</span><span class="n">PJSIP_EVENT_RX_MSG</span> <span class="o">&amp;&amp;</span> <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pjsip_rx_data</span> <span class="o">*</span><span class="n">rdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">pjsip_rx_data</span><span class="o">*</span><span class="p">)</span> <span class="n">event_src</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pj_assert</span><span class="p">(</span><span class="n">rdata</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rdata</span><span class="o">-&gt;</span><span class="n">msg_info</span><span class="p">.</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">PJSIP_RESPONSE_MSG</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>         <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span><span class="o">-&gt;</span><span class="n">on_rx_response</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="p">(</span><span class="o">*</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span><span class="o">-&gt;</span><span class="n">on_rx_response</span><span class="p">)(</span><span class="n">rdata</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Inform TU about state changed. */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span> <span class="o">&amp;&amp;</span> <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span><span class="o">-&gt;</span><span class="n">on_tsx_state</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pjsip_event</span> <span class="n">e</span><span class="p">;</span>
</span><span class='line'>  <span class="n">PJSIP_EVENT_INIT_TSX_STATE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">tsx</span><span class="p">,</span> <span class="n">event_src_type</span><span class="p">,</span> <span class="n">event_src</span><span class="p">,</span>
</span><span class='line'>                 <span class="n">prev_state</span><span class="p">);</span>
</span><span class='line'>  <span class="p">(</span><span class="o">*</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">tsx_user</span><span class="o">-&gt;</span><span class="n">on_tsx_state</span><span class="p">)(</span><span class="n">tsx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* When the transaction is terminated, release transport, and free the</span>
</span><span class='line'><span class="cm">     * saved last transmitted message.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">PJSIP_TSX_STATE_TERMINATED</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pj_time_val</span> <span class="n">timeout</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* If we&#39;re still waiting for a message to be sent.. */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">transport_flag</span> <span class="o">&amp;</span> <span class="n">TSX_HAS_PENDING_TRANSPORT</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="cm">/* Disassociate ourselves from the outstanding transmit data</span>
</span><span class='line'><span class="cm">      * so that when the send callback is called we will be able</span>
</span><span class='line'><span class="cm">      * to ignore that (otherwise we&#39;ll get assertion, see</span>
</span><span class='line'><span class="cm">      * http://trac.pjsip.org/repos/ticket/1033)</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">pending_tx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">pending_tx</span><span class="o">-&gt;</span><span class="n">mod_data</span><span class="p">[</span><span class="n">mod_tsx_layer</span><span class="p">.</span><span class="n">mod</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">pending_tx</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">transport_flag</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">TSX_HAS_PENDING_TRANSPORT</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">lock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Cancel timeout timer. */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pjsip_endpt_cancel_timer</span><span class="p">(</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">TIMER_ACTIVE</span><span class="p">;</span>
</span><span class='line'>  <span class="n">pjsip_endpt_schedule_timer</span><span class="p">(</span> <span class="n">tsx</span><span class="o">-&gt;</span><span class="n">endpt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tsx</span><span class="o">-&gt;</span><span class="n">timeout_timer</span><span class="p">,</span>
</span><span class='line'>                  <span class="o">&amp;</span><span class="n">timeout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">unlock_timer</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">PJSIP_TSX_STATE_DESTROYED</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Unregister transaction. */</span>
</span><span class='line'>  <span class="n">mod_tsx_layer_unregister_tsx</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Destroy transaction. */</span>
</span><span class='line'>  <span class="n">tsx_destroy</span><span class="p">(</span><span class="n">tsx</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">pj_log_pop_indent</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[正则表达式]]></title>
    <link href="http://coolbrain.github.com/blog/2013/09/26/regular-expression/"/>
    <updated>2013-09-26T22:44:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/09/26/regular-expression</id>
    <content type="html"><![CDATA[<blockquote><p><p>由于pjsip函数的返回值用宏定义，Source Insight工具无法识别为函数，因此在阅读代码的时候难以找到函数的定义，给理解代码带来一定的麻烦。这正是考验自己的时候，其实遇到这样的问题很平常，解决也很简单，只是没碰到过，所以觉得无法入手。使用正则表达式，很好的解决这个问题，把宏替换，在Linux下的命令为：</p></p></blockquote>

<figure class='code'><figcaption><span>批量替换  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>find . -name <span class="s2">&quot;*.[c|h]&quot;</span> | xargs perl -pi -e <span class="s2">&quot;s|PJ_DEF\(([^\(]*)\)|$1|g&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>批量地找c和h文件，替换PJ_DEF宏，但保留参数不变。掌握正则表达式，对提高工作效率有比较大的帮助。</p>
<!-- more -->
<p>掌握正则表达式，并且配合grep，sed，awk，perl，python等工具一起使用，对于文本处理，威力就无穷大了。</p></p></blockquote>

<figure class='code'><figcaption><span>一般的正则表达式匹配：  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>.代表的是任意字符，*代表的是多个，<span class="o">[</span>a-z|A-Z<span class="o">]</span>代表的是字母，^<span class="o">[</span>list<span class="o">]</span>代表的是以list开头，
</span><span class='line'><span class="o">[</span>^list<span class="o">]</span>代表的是不是list的，<span class="o">[</span>list<span class="o">]</span><span class="nv">$代</span>表的是以list为结尾，匹配一些特殊符号需要转义，
</span><span class='line'>如<span class="se">\(</span>, <span class="se">\t</span>;<span class="se">\{</span>1,15<span class="se">\}</span>代表的是1-15个。
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><p>匹配host的IP地址的方式：</p></p></blockquote>

<figure class='code'><figcaption><span>匹配host的IP地址的方式：  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/http:\/\/([\d.]*):[\d]*\/\S*/&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.1.100:8080/tr069&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nx">ip</span> <span class="o">=</span> <span class="nx">result</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
