<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ForgeBrain]]></title>
  <link href="http://coolbrain.github.com/atom.xml" rel="self"/>
  <link href="http://coolbrain.github.com/"/>
  <updated>2014-03-07T23:26:02+08:00</updated>
  <id>http://coolbrain.github.com/</id>
  <author>
    <name><![CDATA[ForgeBrain]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[linux防止僵尸进程]]></title>
    <link href="http://coolbrain.github.com/blog/2014/03/07/zombie-process/"/>
    <updated>2014-03-07T22:37:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/03/07/zombie-process</id>
    <content type="html"><![CDATA[<blockquote><p><p>平时如果不太注意创建子进程的处理，有可能会导致僵尸进程，以至于有一天系统无法创建进程，超过系统允许的最大进程数。如果不捕捉SIGCHLD信号，子进程退出时，系统默认释放进程的内核结构。如果捕捉了，但父进程没有调用wait或waitpid等函数获取子进程的退出状态，那么在父进程还没有退出时，子进程就会成为僵尸进程。另外一种情况，由于linux信号不等待，可能丢失了信号，父进程也没有获取子进程的退出状态。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>linux防止僵尸进程的代码  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;sys/wait.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;signal.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">sig_child</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//解决信号不排队的状况，假如两个子进程同时退出，信号SIGCHLD只有一个，通过while俩防止出现这种情况</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Handler reaped child %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">ECHILD</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;waitpid error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//建立SIGCHLD信号处理函数，获取子进程的退出状态，防止出现僵尸进程</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="n">sig_child</span><span class="p">)</span> <span class="o">==</span> <span class="n">SIG_ERR</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;signal error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from child %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">getpid</span><span class="p">());</span>
</span><span class='line'>          <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//处理慢系统调用被信号打断的情况</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">STDIN_FILENO</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">EINTR</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;read error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Parent processing input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[popen函数执行程序]]></title>
    <link href="http://coolbrain.github.com/blog/2014/03/07/popen/"/>
    <updated>2014-03-07T22:37:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/03/07/popen</id>
    <content type="html"><![CDATA[<blockquote><p><p>使用linux定时器可以定时的处理一些事务或者定时的发出一些信号，如SIGALRM，SIGINT，SIGQUIT等信号。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>popen函数代码  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;fcntl.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/wait.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define  MAX_FD      1024</span>
</span><span class='line'><span class="k">static</span> <span class="n">pid_t</span> <span class="o">*</span><span class="n">childPid</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">FILE</span> <span class="o">*</span><span class="nf">popen_cmd</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pCmd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pType</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
</span><span class='line'>  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">pipeFd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">FILE</span> <span class="o">*</span><span class="n">pFile</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pCmd</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">pType</span> <span class="o">!=</span> <span class="sc">&#39;r&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">pType</span> <span class="o">!=</span> <span class="sc">&#39;w&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">pType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">errno</span> <span class="o">=</span> <span class="n">EINVAL</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">childPid</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">childPid</span> <span class="o">=</span> <span class="p">(</span><span class="n">pid_t</span> <span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">MAX_FD</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pid_t</span><span class="p">));</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">childPid</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="c1">//type是对父进程而言，当为&#39;r&#39;时，子进程应该关闭读端.</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">pType</span> <span class="o">==</span> <span class="sc">&#39;r&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>          <span class="c1">// 把STDOUT_FILENO重定向pipeFd[1]</span>
</span><span class='line'>          <span class="n">dup2</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">STDOUT_FILENO</span><span class="p">);</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>          <span class="n">dup2</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">STDIN_FILENO</span><span class="p">);</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">MAX_FD</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">childPid</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">close</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">execl</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s">&quot;sh&quot;</span><span class="p">,</span> <span class="s">&quot;-c&quot;</span><span class="p">,</span> <span class="n">pCmd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="n">_exit</span><span class="p">(</span><span class="mi">127</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">pType</span> <span class="o">==</span> <span class="sc">&#39;r&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">((</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fdopen</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pType</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">((</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fdopen</span><span class="p">(</span><span class="n">pipeFd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pType</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">childPid</span><span class="p">[</span><span class="n">fileno</span><span class="p">(</span><span class="n">pFile</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">pFile</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">pclose_cmd</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">pFile</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">status</span><span class="p">;</span>
</span><span class='line'>  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">childPid</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">pFile</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">fileno</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">childPid</span><span class="p">[</span><span class="n">fd</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">childPid</span><span class="p">[</span><span class="n">fd</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">EINTR</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'><span class="nl">error:</span>
</span><span class='line'>  <span class="n">errno</span> <span class="o">=</span> <span class="n">EINVAL</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">line</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span class='line'>  <span class="kt">FILE</span> <span class="o">*</span><span class="n">pFile</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pFile</span> <span class="o">=</span> <span class="n">popen_cmd</span><span class="p">(</span><span class="s">&quot;ifconfig eth0&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pFile</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">pFile</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">pclose_cmd</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[linux定时器]]></title>
    <link href="http://coolbrain.github.com/blog/2014/03/07/timer/"/>
    <updated>2014-03-07T22:36:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/03/07/timer</id>
    <content type="html"><![CDATA[<blockquote><p><p>使用linux定时器可以定时的处理一些事务或者定时的发出一些信号，如SIGALRM，SIGINT，SIGQUIT等信号。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>linux定时器的代码  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;signal.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;time.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/time.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define errExit(msg)    do { perror(msg); exit(EXIT_FAILURE); } while (0)</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">sig_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">,</span> <span class="n">siginfo_t</span> <span class="o">*</span><span class="n">si</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Caught signal %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sig</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>   <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">timer_t</span> <span class="n">timerid</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigevent</span> <span class="n">sev</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">itimerspec</span> <span class="n">its</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigset_t</span> <span class="n">newMask</span><span class="p">,</span> <span class="n">oldMask</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">sa</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sa</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="n">SA_SIGINFO</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sa</span><span class="p">.</span><span class="n">sa_sigaction</span> <span class="o">=</span> <span class="n">sig_handler</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sa</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sa</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">errExit</span><span class="p">(</span><span class="s">&quot;sigaction&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">errExit</span><span class="p">(</span><span class="s">&quot;sigprocmask&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_notify</span> <span class="o">=</span> <span class="n">SIGEV_SIGNAL</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_signo</span> <span class="o">=</span> <span class="n">SIGINT</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_value</span><span class="p">.</span><span class="n">sival_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">timerid</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">timer_create</span><span class="p">(</span><span class="n">CLOCK_REALTIME</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timerid</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">errExit</span><span class="p">(</span><span class="s">&quot;timer_create&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">its</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">its</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">its</span><span class="p">.</span><span class="n">it_interval</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="n">its</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">;</span>
</span><span class='line'>  <span class="n">its</span><span class="p">.</span><span class="n">it_interval</span><span class="p">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="n">its</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">timer_settime</span><span class="p">(</span><span class="n">timerid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">its</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">errExit</span><span class="p">(</span><span class="s">&quot;timer_settime&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">errExit</span><span class="p">(</span><span class="s">&quot;sigprocmask&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[linux信号处理的应用]]></title>
    <link href="http://coolbrain.github.com/blog/2014/03/07/system-sleep/"/>
    <updated>2014-03-07T22:36:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/03/07/system-sleep</id>
    <content type="html"><![CDATA[<blockquote><p><p>linux的system和sleep都涉及到信号的处理，以下是关于在实现system函数和sleep所涉及到的原理。</p>
<p>1.每个进程只有一个闹钟时钟，alarm；且alarm和setitimer共享一个定时器，因此它们会互相干扰。不过通过timer_create和timer_settime可以创建定时器和设置定时器，同时所发送的信号不限定于SIGALRM，可以是其它的SIGINT，SIGQUIT等信号。</p>
<!-- more -->
<p>2.sigsuspend(sigset_t *set)阻塞等待不再集合set的信号，并且调用对应的信号处理函数。sigsuspending保留发生的信号；</p>
<p>3.sigprocmask屏蔽信号集或打开信号集，返回之前的信号集，以用于未来还原到原来的状态。</p>
<p>4.sigaction设置信号对应的信号处理函数，和返回之前的信号处理函数，以便于未来还原到原来的处理信号处理函数</p>
<p>5.sleep可以被各种信号打断</p>
<p>6.信号实现父子进程间的同步，sigsuspend</p>
<p>7.popen创建管道，fork产生一个子进程，关闭管道的不使用端，执行一个shell以运行命令，然后等待命令结束</p>
<p>8.pipe(fd)管道是半双工的，socketpair域套接字是全双工的</p></p></blockquote>

<figure class='code'><figcaption><span>system和sleep函数  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;signal.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;time.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/wait.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/time.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">sig_alarm</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;catch SIGALRM in sleep_cmd</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">sig_real_alarm</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;catch real SIGALRM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">system_cmd</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pCmd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigset_t</span> <span class="n">newMask</span><span class="p">,</span> <span class="n">oldMask</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">currAction</span><span class="p">,</span> <span class="n">oldAction</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pCmd</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">currAction</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">SIG_IGN</span><span class="p">;</span>
</span><span class='line'>  <span class="n">currAction</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">currAction</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">currAction</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGQUIT</span><span class="p">,</span><span class="o">&amp;</span><span class="n">currAction</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oldMask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="n">SIGCHLD</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="n">sigaction</span><span class="p">(</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="n">execl</span><span class="p">(</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span> <span class="s">&quot;sh&quot;</span><span class="p">,</span> <span class="s">&quot;-c&quot;</span><span class="p">,</span> <span class="n">pCmd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="n">_exit</span><span class="p">(</span><span class="mi">127</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">EINTR</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">status</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//sleep_cmd未处理与以前设置的闹钟的交互作用, 现在的处理会使之前设置的闹钟失效</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">sleep_cmd</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nsec</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">sigset_t</span> <span class="n">newMask</span><span class="p">,</span> <span class="n">oldMask</span><span class="p">,</span> <span class="n">suspendMask</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">newAction</span><span class="p">,</span> <span class="n">oldAction</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">uslept</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">newAction</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">sig_alarm</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newAction</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">newAction</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">newAction</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;set SIGALRM new action error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="n">SIGALRM</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">newMask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">alarm</span><span class="p">(</span><span class="n">nsec</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">suspendMask</span> <span class="o">=</span> <span class="n">oldMask</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigdelset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">suspendMask</span><span class="p">,</span> <span class="n">SIGALRM</span><span class="p">);</span>   <span class="c1">//不阻塞SIGALRM</span>
</span><span class='line'>  <span class="n">sigsuspend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">suspendMask</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">uslept</span> <span class="o">=</span> <span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;set SIGALRM old Action error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldMask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">uslept</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">cmdLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">remainSec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">cmdBuff</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span class='line'>  <span class="c1">//struct itimerval its;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">itimerspec</span> <span class="n">itms</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">sigAction</span><span class="p">;</span>
</span><span class='line'>  <span class="n">timer_t</span> <span class="n">timerid</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sigevent</span> <span class="n">sev</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;no cmd of argv</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">sprintf</span><span class="p">(</span><span class="n">cmdBuff</span> <span class="o">+</span> <span class="n">cmdLen</span><span class="p">,</span> <span class="s">&quot;%s &quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
</span><span class='line'>      <span class="n">cmdLen</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">cmdBuff</span><span class="p">[</span><span class="n">cmdLen</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cmdBuff</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">system_cmd</span><span class="p">(</span><span class="n">cmdBuff</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sigAction</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">sig_real_alarm</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sigAction</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sigAction</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sigaction</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sigAction</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm"> its.it_value.tv_sec = 1;</span>
</span><span class='line'><span class="cm"> its.it_value.tv_usec = 0;</span>
</span><span class='line'><span class="cm"> its.it_interval.tv_sec = 1;</span>
</span><span class='line'><span class="cm"> its.it_interval.tv_usec = 0;</span>
</span><span class='line'><span class="cm"> if (setitimer(ITIMER_REAL, &amp;its, NULL)) </span>
</span><span class='line'><span class="cm"> {</span>
</span><span class='line'><span class="cm">     printf(&quot;set timer error\n&quot;);</span>
</span><span class='line'><span class="cm"> }*/</span>
</span><span class='line'>  <span class="c1">//setitimer 与 alarm共用一个定时器，互相干扰。</span>
</span><span class='line'>  <span class="c1">//创建定时器，发送的信号为SIGALRM</span>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_notify</span> <span class="o">=</span> <span class="n">SIGEV_SIGNAL</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_signo</span> <span class="o">=</span> <span class="n">SIGALRM</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sev</span><span class="p">.</span><span class="n">sigev_value</span><span class="p">.</span><span class="n">sival_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">timerid</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">timer_create</span><span class="p">(</span><span class="n">CLOCK_REALTIME</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timerid</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;timer_create error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">itms</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">itms</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">itms</span><span class="p">.</span><span class="n">it_interval</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="n">itms</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">;</span>
</span><span class='line'>  <span class="n">itms</span><span class="p">.</span><span class="n">it_interval</span><span class="p">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="n">itms</span><span class="p">.</span><span class="n">it_value</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//设置定时器</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">timer_settime</span><span class="p">(</span><span class="n">timerid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itms</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;timer_settime error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">remainSec</span> <span class="o">=</span> <span class="n">sleep_cmd</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;remain second: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">remainSec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*setitimer(ITIMER_REAL, &amp;its, NULL);*/</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>      <span class="n">raise</span><span class="p">(</span><span class="n">SIGKILL</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[shell自动打包修改文件]]></title>
    <link href="http://coolbrain.github.com/blog/2014/03/07/get-changed-file/"/>
    <updated>2014-03-07T22:36:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/03/07/get-changed-file</id>
    <content type="html"><![CDATA[<blockquote><p><p>每一次写完代码，都需要将代码发给项目负责人合入到svn上。但时间一长，自己就连修改了哪些源文件也不知道了。于是思来想去，还是写一个靠谱的脚本好一些，这样可以减轻脑力的负担，以后这样繁琐的工作就留给脚本去做了，不亦乐哉，所谓穷则思变。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>查找修改的文件  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c">#查找在一段时间内修改过的.c和.h文件，并把其导出到对应的目录下</span>
</span><span class='line'>
</span><span class='line'><span class="nb">read</span> -p <span class="s2">&quot;please input the file which you want to search the modified: &quot;</span>   searchFile
</span><span class='line'><span class="nb">read</span> -p <span class="s2">&quot;please input the file which you want to save: &quot;</span>    modifydir
</span><span class='line'><span class="nb">read</span> -p <span class="s2">&quot;please input the range day of the file modified: &quot;</span>  withinDay
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$searchFile&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nv">searchFile</span><span class="o">=</span>linux_bcm9970v1
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$modifydir&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nv">modifydir</span><span class="o">=</span>linux_work
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$withinDay&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nv">withinDay</span><span class="o">=</span>2
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span> -d <span class="nv">$modifydir</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> rm -rf <span class="nv">$modifydir</span> <span class="o">&amp;&amp;</span> rm -rf <span class="nv">$modifydir</span>.tar.gz
</span><span class='line'>mkdir -p <span class="nv">$modifydir</span>
</span><span class='line'><span class="nv">current_dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">findlist</span><span class="o">=</span><span class="k">$(</span>find <span class="nv">$current_dir</span>/<span class="nv">$searchFile</span> -name <span class="s2">&quot;*\.[ch]&quot;</span> -mtime  -<span class="nv">$withinDay</span> -print<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">for </span>list in <span class="nv">$findlist</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span><span class="nv">realPath</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$list</span> | sed s/<span class="nv">$searchFile</span>/<span class="nv">$modifydir</span>/g | sed <span class="s1">&#39;s/\/[a-zA-Z0-9_]*\.[ch]//g&#39;</span> <span class="k">)</span>
</span><span class='line'>  <span class="o">[</span> -d <span class="nv">$realPath</span> <span class="o">]</span> <span class="o">||</span> mkdir -p <span class="nv">$realPath</span>
</span><span class='line'>  cp <span class="nv">$list</span> <span class="nv">$realPath</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>
</span><span class='line'>tar -zcvf <span class="nv">$modifydir</span>.tar.gz <span class="nv">$modifydir</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[nginx服务器 性能至上]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/nginx-web-server/"/>
    <updated>2014-02-23T11:31:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/nginx-web-server</id>
    <content type="html"><![CDATA[<blockquote><p><p>nginx是高性能的代理服务器，可支持web和mail两种代理，多进程多线程的模块化的服务端设计。</p>
<!-- more -->
<p>1.nginx的主进程与工作进程的通信方式，域套接字；</p>
<p>2.采用的是事件驱动模型，epoll模型，包括网络事件和时钟事件；</p>
<p>3.对http请求的处理类似于管道的处理，模块拓展性好；</p>
<p>4.配置文件通过命令解析，存储到对应的结构体，且配置文件有分层的配置，http，server，location的配置，在不同的情况下，使用不同的
处理方式，配置文件如同指示牌，控制着程序的执行流程和一些属性。</p>
<p>5.基于有多少个CPU核，配置多少个工作进程，以免在Linux抢占式方式下，导致进程上下文切换，导致性能的降低；</p>
<p>6.可以配置工作进程里有多少条线程，线程上下文切换的开销比进程上下文切换的开销少得多，因此可以设置到每个进程里有128条线程，有多个线程的作用在于在当前线程需要等待磁盘或网络事件时，可以切换到另外一条线程执行，以提高CPU的利用率；线程间通信通过信号量，不过这里使用的是pthread_cond_signal和pthread_cond_wait,而不是sem_post和sem_wait;</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iptables 瑞士军刀]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/iptables-firewall/"/>
    <updated>2014-02-23T11:30:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/iptables-firewall</id>
    <content type="html"><![CDATA[<blockquote><p><p>netfilter/iptables可以配置有状态的防火墙。iptables设置filter过滤表，nat转发表，mangle修改数据包的表。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>iptables设置的防火墙规则  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#! /bin/bash</span>
</span><span class='line'><span class="c">#1.输入相关参数</span>
</span><span class='line'><span class="nv">EXTIF</span><span class="o">=</span><span class="s2">&quot;eth0&quot;</span>
</span><span class='line'><span class="nv">INIF</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="nv">INNET</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">export </span>EXTIF INIF INNET
</span><span class='line'>
</span><span class='line'><span class="c">#2.设置内核的网络功能</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/tcp_syncookies
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
</span><span class='line'>
</span><span class='line'><span class="c">#3.清除规则，设置默认策略和开放lo</span>
</span><span class='line'>iptables -F
</span><span class='line'>iptables -X
</span><span class='line'>iptables -Z
</span><span class='line'>iptables -P INPUT DROP
</span><span class='line'>iptables -P OUTPUT ACCEPT
</span><span class='line'>iptables -P FORWARD ACCEPT
</span><span class='line'>iptables -A INPUT -i lo -j ACCEPT
</span><span class='line'>iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c">#4.启动额外的防火墙script模块</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -f /usr/local/iptables/iptables.deny <span class="o">]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span>sh /usr/local/iptables/iptables.deny
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="c">#5.允许其它类型的icmp包进入</span>
</span><span class='line'><span class="nv">AICMP</span><span class="o">=</span><span class="s2">&quot;0 3 3/4 4 11 12 14 16 18&quot;</span>
</span><span class='line'><span class="k">for </span>typeicmp in <span class="nv">$AICMP</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span>iptables -A INPUT -i <span class="nv">$EXTIF</span> -p icmp --icmp-type <span class="nv">$typeicmp</span> -j ACCEPT
</span><span class='line'><span class="k">done</span>
</span><span class='line'>
</span><span class='line'><span class="c">#6.允许某些服务进入</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 21 --sport 1024:65535 -j ACCEPT  <span class="c">#FTP</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 22 --sport 1024:65535 -j ACCEPT  <span class="c">#SSH</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 25 --sport 1024:65535 -j ACCEPT  <span class="c">#SMTP</span>
</span><span class='line'>iptables -A INPUT -p UDP -i <span class="nv">$EXTIF</span> --dport 53 --sport 1024:65535 -j ACCEPT  <span class="c">#DNS</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 53 --sport 1024:65535 -j ACCEPT  <span class="c">#DNS</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 80 --sport 1024:65535 -j ACCEPT  <span class="c">#WWW</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 110 --sport 1024:65535 -j ACCEPT  <span class="c">#POP3</span>
</span><span class='line'>iptables -A INPUT -p TCP -i <span class="nv">$EXTIF</span> --dport 443 --sport 1024:65535 -j ACCEPT  <span class="c">#HTTPS</span>
</span><span class='line'>
</span><span class='line'><span class="c">#7.先加载有用的模块</span>
</span><span class='line'><span class="nv">modules</span><span class="o">=</span><span class="s2">&quot;ip_tables iptable_nat ip_nat_ftp ip_nat_irc ip_conntrack ip_conntrack_ftp ip_conntrack_irc&quot;</span>
</span><span class='line'><span class="k">for </span>mod in <span class="nv">$modules</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">  </span><span class="nv">testmod</span><span class="o">=</span><span class="sb">`</span>lsmod | grep <span class="s2">&quot;^${mod}&quot;</span> | awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$testmod&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">      </span>modprobe <span class="nv">$mod</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>
</span><span class='line'><span class="c">#8.清除nat table的规则</span>
</span><span class='line'>iptables -F -t nat
</span><span class='line'>iptables -X -t nat
</span><span class='line'>iptables -Z -t nat
</span><span class='line'>iptables -t nat -P PREROUTING ACCEPT
</span><span class='line'>iptables -t nat -P POSTROUTING ACCEPT
</span><span class='line'>iptables -t nat -P OUTPUT ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c">#9.若有内部接口的存在（双网卡）开放成为路由器，且为ip分享器</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$INIF&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span>iptables -A INPUT -i <span class="nv">$INIF</span> -j ACCEPT
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;1&quot;</span> &gt;     /proc/sys/net/ipv4/ip_forward
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$INNET&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">      for </span>innet in <span class="nv">$INNET</span>
</span><span class='line'>      <span class="k">do</span>
</span><span class='line'><span class="k">          </span>iptables -t nat -A POSTROUTING -s <span class="nv">$innet</span> -o <span class="nv">$EXTIF</span> -j MASQUERADE
</span><span class='line'>      <span class="k">done</span>
</span><span class='line'><span class="k">  fi</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[初入门规 shell编程]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/shell-programme/"/>
    <updated>2014-02-23T11:29:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/shell-programme</id>
    <content type="html"><![CDATA[<blockquote><p><p>shell脚本在工作中可以大大提高工作的效率。因此学习shell是非常有必要的。</p>
<!-- more --></p></blockquote>

<figure class='code'><figcaption><span>常见的linux命令  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#! /bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c">#find / -name *.sh -exec wc -c {} \;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#-exec 执行简单的命令，最好还是使用xargs来代替</span>
</span><span class='line'>find . -type f -perm 664 -exec ls -l <span class="o">{}</span> <span class="se">\;</span>
</span><span class='line'>
</span><span class='line'>find . -type f -print | xargs grep <span class="s2">&quot;module&quot;</span>
</span><span class='line'>
</span><span class='line'>find . -size +1000000c -print
</span><span class='line'>
</span><span class='line'><span class="c">#获取ipv4和ipv6的ip地址</span>
</span><span class='line'>ifconfig eth0 | grep inet | sed <span class="s1">&#39;s/^.* addr://g&#39;</span> | sed <span class="s1">&#39;s/Bcast.*$//g&#39;</span> | sed <span class="s1">&#39;s/Scope.*$//g&#39;</span> | sed <span class="s1">&#39;s/^[ ]*//g&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#获取ipv4的地址</span>
</span><span class='line'>ifconfig eth0 | grep <span class="s2">&quot;inet addr:&quot;</span> | awk <span class="s1">&#39;{ print $2 }&#39;</span> | cut -c 6- | sed <span class="s1">&#39;s/[0-9|.]*/ipv4 addr:\n&amp;/g&#39;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[龙马精神 马到功成]]></title>
    <link href="http://coolbrain.github.com/blog/2014/02/23/2014-new-year-plan/"/>
    <updated>2014-02-23T11:23:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2014/02/23/2014-new-year-plan</id>
    <content type="html"><![CDATA[<blockquote><p><p> 新概念三有篇课文《New Year resolution》,说作者立下志向，从新年起，每天进行锻炼和坚持阅读，可惜新年还没结束，虽然计划没有胎死腹中，但几日后就泡汤了。</p>
<!-- more -->
<img src="http://coolbrain.github.com/assets/images/plan/one.png" alt="&quot;one&quot;" />
<img src="http://coolbrain.github.com/assets/images/plan/two.png" alt="&quot;two&quot;" />
<img src="http://coolbrain.github.com/assets/images/plan/three.png" alt="&quot;three&quot;" /></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[长亭外 古道边 芳草碧连天]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/12/end-of-period/"/>
    <updated>2013-12-12T23:33:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/12/end-of-period</id>
    <content type="html"><![CDATA[<blockquote><p><p>离别总是有时让人伤感的，但回来的感觉真好！因为把系统升级到Win8，之前配置写博客和程序也跟着没了。于是前段时间也没有在此写些琐碎的东西，记录生活的点点滴滴。</p>
<!-- more -->
<p>这段时间经历了元旦、春节等传统节日。元旦稍微写了2014年的计划，春节主要是去玩，可惜想找到合适的人一起去玩，是挺不容易的。理想和现实是有差距的，我理想中的玩是即是一种休息娱乐，也是生活中的更高一层的体验。谈谈心，探索啊人生的一些问题，可谓不亦乐乎！没必要把事事看得那么死板、闷气，其实转换个角度，放开心胸，更能够高质量地生活下去。人不可以太纠结于鸡毛蒜皮的事，人可以豁达，正如苏轼所说：“回首向来萧瑟处，也无风雨也无晴。&#8221;</p>
<p>所谓物以类聚，人以群分。和怎样的人相处，就在一定程度上说明你是一个怎样的人，也会是能到达到一个什么程度的人。和有见识有理想有行动的人一起，长智慧；和风趣幽默玩转人生的人一起，长情操。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[修行以行制性 悟道以性施行]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/remote-saver/"/>
    <updated>2013-12-02T21:57:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/remote-saver</id>
    <content type="html"><![CDATA[<p>这个周末，同学分享了《遥远的救世主》，内容不错。对于生活，应该拓宽生活的宽度，多一些内涵与修养，少一些暴躁与戾气。</p>


<p>以下是在谈论中阐述到的语录：</p>


<!-- more -->


<p>1. 所谓真经，就是能够达到寂空涅盘的究竟法门，可悟不可修。修为成佛，在求。悟为明性，在知。修行以行制性，悟道以性施行，觉者由心生律，修者以律制心。不落恶果者有信无证，住因住果、住念住心，如是生灭。不昧因果者无住而住，无欲无不欲，无戒无不戒，如是涅盘。</p>


<p>2.悟道方知天命，修行务取真经， 一生一灭一枯荣，皆有因缘注定。 袈裟原本清净，红尘即是性空， 幽幽古刹千年钟，解了几多痴梦！</p>


<p>3.强势文化就是遵循事物规律的文化，弱势文化就是依赖强者的道德期望破格获取的文化，也是期望救主的文化。强势文化在武学上被称为&#8221;秘笈&#8221;，而弱势文化由于易学、易懂、易用，成了流行品种。</p>


<p>4.天下之道论到极致，百姓的柴米油盐；人生冷暖论到极致，男人和女人的一个情字。</p>


<p>5.更高级的哲人独处着，这并不是因为他想孤独，而是因为在他周围找不到他的同类。</p>


<p>6. 这个年代，执着于出人头地并不难，难的恰恰是不执着于出人头地 ；一颗阴暗的心永远托不起一张灿烂的脸。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[冰雪聪明 超然脱俗]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/the-model-of-huangrong/"/>
    <updated>2013-12-02T21:51:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/the-model-of-huangrong</id>
    <content type="html"><![CDATA[<blockquote><p><p>黄蓉，金庸小说《射雕英雄传》的女主角，刚和郭靖在一起的时候，其敢于面对现实，不受世俗的束缚，不但郭靖的师父就是不同意他们在一起，而且郭靖与华筝有婚姻之约，她也不介意这些，因为在当时她认为两人在一起，只要开心就可以，但其也不是什么事情都不管。她懂得在适当的时候，制造机会让郭靖向洪七公学习武功，并成为其嫡传弟子。因为她也明白，她爹爹是不会喜欢一个文武都不在行的人。</p>
<!-- more -->
<p>在其父亲反对其和傻小子郭靖子在一起，黄蓉一直偏袒着郭靖，直至欧阳锋带着侄儿欧阳克到桃花岛求婚，她爹还有意将其嫁给欧阳克。但黄蓉不屈服于现实，她深知自己力量薄弱，于是千里叫洪七公来挑花岛相助，后来才有欧阳克与郭靖的文武比试。</p>
<p>虽然过了比试，但前路也不平坦。后来两人误会产生，是由于郭靖认定其五个师傅被黄药师所杀。黄蓉在烟雨楼比试时，还感叹好好的幸福就毁于此。她最后简直豁出去了，为了将真相搞明白，和欧阳锋斗智，让真相水落石出。为了让郭靖的大师傅逃出，因为他是整件事情的关键， 她只能落入欧阳锋之手。</p>
<p>两人冰释前嫌，暂时并没有走在一起，黄蓉也没有怪责郭靖误会自己，且暗中帮助其行军打仗，从中出谋划策。郭靖因为发生的种种事情而没有和有婚姻之约的华筝完婚。因为其心里只有一个人，因为两人都懂得为对方付出。在黄蓉被受了铁沙掌的时候，郭靖甘愿为她付出一切。</p>
<p>黄蓉是一个不受所谓的观念，世俗的规则所束缚，同时也是一个敢于追求幸福的人，眼光好，明白郭靖是可造之才和会一心一意对她。这其实在她刚出江湖，办成小乞丐，郭靖却愿意倾其所有让其喝饱吃足，就可知郭靖的人品了。</p>
<p>听闻人生的本质是孤独，寂寞和悲凉，两个孤独的人相处是很容易产生感情。爱情只是让孤独的人类能够活下来。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[管中窥豹 盲人摸象]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/02/newbie-of-java/"/>
    <updated>2013-12-02T20:05:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/02/newbie-of-java</id>
    <content type="html"><![CDATA[<p>实习期间，课题是openacs的继续开发，由于openacs是Java开发，因此做了两个月的Java开发，稍微总结一下：</p>


<p>Java的容器Collection类库，String、Array，list，map等，特别是与数据库操作结合在一起的时候，但性能比起直接使用SQL会略差些。但Java的接口如Comparable，serialize等，实现对象的排序和序列化。并且懂得如何将对象序列化保存到数据库，然后再从数据库中读出，也同时使用blob字段保存大容量的数据字段。</p>


<blockquote><p><!-- more --></p></blockquote>

<p>Java的servlet技术，request，response，session，cookie等，这些封装了http的对象，不过session是使http具有会话性的，而cookie主要是保存用户的信息。</p>


<p>Java的正则表达式的易用性,在当时的项目里，使用正则表达式处理字符串相当好，一下子就把问题解决了</p>


<p>Java的JSF使用，不过我比较讨厌控件的使用。因为我不愿意学这些东西。这只是我的借口，这些东西的设计都是比较类似的，学会一个，基本上就会使用其它的一些控件。</p>


<p>Java的EJB企业服务Bean，Java的soap类库，Java的JMS通信，这些在实现一些业务逻辑的时候会比较方便。并且终于感受到了Java抽象类，继承的优势所在，动态绑定对象，用instanceof来检测对象的类型，从而触发相应的逻辑。</p>


<p>过去的时光对于我来说，虽然是一个不好的经历。只可惜，以前自己没有体会到这些，不然就不会落得如此田地！浪子回头金不换。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[你知道了你 你就不是你]]></title>
    <link href="http://coolbrain.github.com/blog/2013/12/01/intern-summary/"/>
    <updated>2013-12-01T22:58:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/12/01/intern-summary</id>
    <content type="html"><![CDATA[<p>实习期间我被分配完成的项目是openACS开发，可是openACS是Java开发，且是J2EE的范畴。我之前以为自己来这个公司是做C语言，网络方面的开发的，但却分配到做Java的，当时就不想在上面花时间，因此开始做的两个星期都是敷衍了事，再继续了两个星期，却发现Java易用，有丰富的类库API，J2EE框架清晰。与之前对Java的印象截然不同，于是才开始不断学习Java，继续openACS的开发。显然，在刚开始之前，我没有转变自己的观念，其实编程，在于的不是使用哪一种语言，而是在于从整体上把握编程思想。不论对于何种语言，都适用。在时间安排上，只要及早地改变心态，可以提前地完成任务，做更多的工作。</p>


<blockquote><p><!-- more --></p></blockquote>

<p>对于答辩，有几点需要改进：</p>


<p>1.对某些概念理解不清，画图不够严谨，没有好好总结之前所学的内容和检查PPT的细节问题。</p>


<p>2.答辩时，态度不够严肃，语速慢。之前没有进行实战演练，观察有什么问题。</p>


<p>3.回答问题时，没有明白对方问题的用意而急于回答。学会倾听，把握好问题，才进行相应的回答。</p>


<p>对于工作，有几点需要改进：</p>


<p>1.对于每天的工作，有一定的安排和目标性，在每天结束后，稍微总结下今天所做的工作。</p>


<p>2.平时休息要好，不能熬夜，影响到正常工作的效率和质量。</p>


<p>3.多点和导师和其它同事交流，从而用更好地方式解决问题。</p>


<p>对于现在openACS开发的情况，基本上继续完成接下来的一些需求的开发，整理好文档和进行相关的测试。</p>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[承上启下 向下兼容]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/16/follow-version/"/>
    <updated>2013-10-16T23:10:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/16/follow-version</id>
    <content type="html"><![CDATA[<blockquote><p><p>window XP默认安装的.NET的2.0版本，window 7默认安装的是.NET4.0版本，而更新的系统就可能安装更新的.NET版本。但好不幸，假如你还在使用XP系统的话，但又想使用最新开发的程序，那么你就安装.NET的比较新的版本了，因为XP .NET2.0版本已经不能支持这些最新开发的程序。但在较新的系统跑较旧的程序，可能就会有些问题，因为有些API会被抛弃。</p>
<!-- more -->
<p>上面是对于在window的.NET平台上开发的程序来说。而在Java平台开发的，比较新的程序要需要运行在较新的JDK上，如JDK 7；较旧的程序也要求运行在较旧的JDK上，如JDK 5；用JDK 5开发的程序未必在JDK 7平台是那个跑，如上面提到的有些API已经被抛弃，可能还需要安装插件。因此下载程序的时候，看清楚所运行的环境，避免不必要的麻烦。</p>
<p>而对于python这样的脚本语言，道理依然是一样，之前写出来的版本只对python2.7有效，对于python3.2就可能无效，除非进行接口的移植和升级。现在的web开发是考虑兼容性最多的，不同的浏览器有不同的实现和不同标准，程序员需要针对每个浏览器写出不同支持性的代码。人人都希望一份通用的代码就能到处跑。另一个方面是通信领域，同样的通信协议，不同的厂商对协议的理解和实现都不一样，导致不同厂商生产的设备直接的通信出现问题。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[依山伴水 绿水长流]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/16/view-of-shenzhen/"/>
    <updated>2013-10-16T00:06:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/16/view-of-shenzhen</id>
    <content type="html"><![CDATA[<blockquote><p><p>外人眼中的深圳是一夜之间崛起的城市。那已经是History了，我想说的Now。生活在深圳，究竟会是怎样？</p>
<!-- more -->
<p><strong>公共设施</strong></p>
<p>按照广州生活的经验来说，广州没什么是触动心灵的，但也不是一无所长，广州在地铁指引方面比深圳做得好，但广州地铁比深圳拥挤。深圳是被称为“图书馆之城”，每个区都有几个图书馆，且有些图书馆设备、环境都是一流，只要有身份证，无论什么人，都可以办理借书证，且全城图书通借通还。深圳的公园搞得特别不错，周六日深圳人都会一家大小到公园玩，整个环境特别和谐。同样深圳的医疗也是相当不错，服务质量和服务态度比广州更上一层楼。</p>
<p><strong>旅游景点</strong></p>
<p>世界之窗（window of world)和锦绣中华(splendid of China)是深圳两大特色景点。</p>
<p><strong>人的素质</strong></p>
<p>深圳的人比较友好，讲文明，基本上的人都是从外面来的，而之后成为深圳人。杂居文化。</p>
<p><strong>发展机会</strong></p>
<p>政策相对好，改革开放的前沿阵地。名企云集之地。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[除了我的无知，我什么都不知道]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/15/live-by-yourself/"/>
    <updated>2013-10-15T22:22:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/15/live-by-yourself</id>
    <content type="html"><![CDATA[<blockquote><p><p>所谓活在这个世界上，许多的烦恼，快乐，平静，温馨，幸福都是由自己的看法所决定的，影响自己不是事情的本事，而是看待事情的方式。有许多次的时候都是“当局者迷旁观者清”的情况，为了避免被一些琐事所困，列出一些常见问题的处理：</p>
<!-- more -->
<p>1.如何做到学有所获？不是糊里糊涂,没有得过且过的感觉？</p>
<p><strong>使用思维导图，层次级描述</strong></p>
<p>2.如何做到自我管理、自我满足？</p>
<p><strong>不蹉跎岁月，把握每分每秒，做一些有意义的事情</strong></p>
<p>3.如何犯了错误时，如何做到不慌慌张张、自怨自艾，反而是淡淡定定地解决问题？</p>
<p><strong>对事情的发生深入分析，做到心中有数</strong></p>
<p>4.如何保证自己的身体健康?</p>
<p><strong>关键是合理的饮食，次之是适当的放松（旅游、打球、看书），但强烈不建议听歌、看电影、看电视剧</strong></p>
<p>5.如何丢弃心理压力的包袱？</p>
<p><strong>看事情不能只从一个角度去看，要多角度分析。不然在一方面吃亏，就焦虑至死</strong></p>
<p>6.平时做人的原则是什么?</p>
<P><strong>论语十则中的：“与朋友交而不信乎？” “己所不欲勿施于人”</strong></p>
<p>7.平时学习的原则是什么？</p>
<p><strong>”温故而知新“；“学而不思则罔思而不学则殆”</strong></p>
<p>8.平时如何去做人？</p>
<p><strong>合理表达请求；婉转表达不满或拒绝；换位思考；三思而后讲</strong></p>
<p>9.人存在的基础是什么？</p>
<p><strong>身体;思想;价值观;世界观</strong></p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[青衫磊落险峰行 玉璧月华明]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/14/fairy-story/"/>
    <updated>2013-10-14T23:10:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/14/fairy-story</id>
    <content type="html"><![CDATA[<blockquote><p><p>之前两日去图书馆准备充电，恰好桌面有一本《天龙八部》，于是随便翻翻，手不释卷就到图书馆关门了。自己背包里的书深藏不露，可惜没有见到天日,还没有大展拳脚，就已经夭折了。</p>
<!-- more -->
<p>既然看了，那就写写关于《天龙八部》的故事吧。</p>
<p>乔峰是个盖世英雄，只可惜被揭为契丹人，两国水火不容，群雄聚而攻之。种种的误解产生都由其父处处布局，让乔峰如老鼠过街人人喊打，考验其绝处逢生的能力。乔峰与阿朱&#8211;这个小丫头互生情愫，阿朱对乔峰的为人和英雄气概极为倾慕；而为身世所困，百思不得其解的乔峰，人人得而诛之的乔峰，心灵无尽空虚的乔峰，在这时，得到阿朱死心塌地的关心和约其到漠北放羊，长相厮守，远离中原的纷争和骚扰。</p>
<p>段誉，人人都说其是书呆子，一心一意地钻研佛学，有普渡众生的理想。机缘巧合，与神仙姐姐塑像偶遇，对其简直是痴迷，向其叩了一千个响头。在曼陀山庄，见到现实之中的神仙&#8211;美丽与智慧的化身&#8211;王语嫣，所谓“窈窕淑女君子好逑”，可惜她心有所属，但对于段誉来说，虽然常被人说：“癞蛤蟆想吃天鹅肉”，但其很珍惜眼前与王语嫣相处的时间，常常寻找机会跟随左右。不是为了博取红颜一笑，而总是舍身相救。</p>
<p>虚竹，一心向佛，心地善良，似笨头笨脑，也似大智若愚，也如郑板桥所说的难得糊涂，无人能解的棋局，其误打误撞创出一片天地，扭转乾坤。小事情糊涂，大事情明白。</p>
<p>木婉清，一个从没见过世面的姑娘，认为吃人肉也是理所当然的，无任何伦理，道德的观念。不过，段誉却能对这个姑娘尊重有加。</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[鞭辟入里 明辨事理]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/10/fact-opinion/"/>
    <updated>2013-10-10T22:36:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/10/fact-opinion</id>
    <content type="html"><![CDATA[<blockquote><p><p>when I read the passage, I always can&#8217;t consciously distinguish the fact and opinion. Sometimes I think the author&#8217;s personal opinion as the fact.if having chance to talk with other&#8217;s, I boast about their opionion though I don&#8217;t know which is original, objective or personal view.The most fearest thing is that I put them into practice and consequently find that they are wrong and liable and I have already wasted a lot of time and done harm to myself.</p>
<!-- more -->
<p>For example,&#8221;no man ever look at the world with pristine eyes. He sees it edited by a definite set of customs and institutions and ways of thinking.&#8221; It sounds reasonable, and may be objective.To persuade reader, the author consequently list fact and eminent man&#8217;s word to support his opinion. Our teacher taught us in junior school.</p>
<p>&#8220;Boardly speaking, human being may be divided into three classes:those who are toiled to death, those who are worried to death, and those who are bored to death.&#8221;The author acquires this opinion according to his observation and reflection. Whatever, he spares no effort to supporting and describing his opinion.&#8221;The seeds must be carefully chosen; they must fall on good ground;they must be sedulouly tended, if the vivifying fruits are to be at hand when needed.&#8221; he uses metaphor describing the process of cultivating hobbies to make reader be aware of the importance of it.</p>
<p>&#8220;The undulating waves of the open sea are generated by three natural causes:wind, earth movements or tremors, and the gravitational pull of the moon and the sun.&#8221;This is fact based on the result of current research which may be overthrowed in the future.It&#8217;s natural phenomenon. &#8220;Appreciaton of sculpture depends upon the ability to respond to form in three dimensions.&#8221; It seems opinion but it&#8217;s fact.</p>
<p>&#8220;This is a sceptical age, but although our faith in many of the things in which our forefathers fervently believed has weakened, our confidence in the curative properties of the bootle of medicine remains the same as theirs&#8221;.Why does the author have this opinion? &#8220;This modern faith in medicines is proved by the fact that the annual drug bill of the Health Services is mounting to astronomical figures and shows no signs at present of ceasing to rise.&#8221; he gets it based on data which we can check on the internet. If the author want to cheat, he may forge some data or fact to support his opinion. Maybe we carelessly trust and suffer a lot.</p></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[穿梭于都市 游走于海滨 休憩于公园]]></title>
    <link href="http://coolbrain.github.com/blog/2013/10/05/swim-park-drink/"/>
    <updated>2013-10-05T21:26:00+08:00</updated>
    <id>http://coolbrain.github.com/blog/2013/10/05/swim-park-drink</id>
    <content type="html"><![CDATA[<blockquote><p><p>国庆第二天目标地点是深圳大梅沙海滨公园，想不到这个海滨公园吸引了五万的游客，在高速公路塞车了两个小时，可把我憋腻了。幸亏我在车上找到另外一种方式来消遣——背单词，兴致盎然，让自己醉于自己的世界，完全感觉不到自己在拥挤不堪的公共汽车上。这种方式打发这样的时光还是非常有效，所以说，影响自己不是事情本身，而是看待事情的方式。</p>
<!-- more -->
<p>经过两个小时，终于到达了目的地——大梅沙，两面环山，前面是海，看到浪一浪接一浪，大家在海水里玩得很开心。忍不住换上泳裤，冲入水里，当海水碰到嘴唇里，才发现海水挺咸的，不像以前在河里玩水，应该有个救生圈，躺在上面，任意其飘荡，享受阳光沐浴。总体来说，感觉还可以，但感觉地方有点不太干净，可能由于是免费的原因，下次再次来海滨玩的话，应该去小梅沙。晚上回来再在租屋的地方K歌，三个男人一台戏。</p>
<p>国庆第三天是深圳的红树林，闻说里面可以看到比较多的鸟，可谓百鸟争鸣。当我们去到的时候，感觉没什么特别，就是带有海湾的公园。不过，在走之前，买了一个椰子，第一次享受喝椰子汁的快感。接着去了市区的莲花山，从莲花山上鸟瞰深圳的中心，高楼林立，器宇轩昂。之后就在市区中心徘徊，市民中心，深圳书城，少年宫&#8230;</p>
<p>国庆的第四天送别了故人，就把精力集中于解决自身的问题，首当其冲的就是耳鸣。我说多少个叫自己重视这些问题也无济于事，最紧要自己心理明白，这问题不能忽视，要用心地呵护。发现在医院看书的效果挺好，在这里才会真正感受病是如此地真实，假如再不珍惜，再继续这样下去，只会抱恨终生。所以当自己不想看书的时候，可以到医院去看，相信是一个不错的选择，:)</p>
<p>晚上又和宿友讨论了下现实和理想之间的差距。主要的观点是：”电影，电视剧，歌曲，只是用来陶冶情操的，而不是用来实现理想的“，因为好多些时候这些都是理想状态，在现实可能到处碰壁，事与愿违。</p></p></blockquote>
]]></content>
  </entry>
  
</feed>
